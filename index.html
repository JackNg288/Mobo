<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Trading Bot Control</title>
    <!-- Bootstrap for mobile-friendly design -->
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.3.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <style>
        body { background-color: #f0f2f5; }
        .log-screen {
            background-color: #1a1a1a;
            color: #f0f0f0;
            font-family: 'Courier New', Courier, monospace;
            height: 400px;
            overflow-y: scroll;
            padding: 15px;
            border-radius: 8px;
            white-space: pre-wrap;
            font-size: 0.8em;
        }
        .btn-custom { margin: 5px; }
    </style>
</head>
<body class="p-3">

    <div class="container">
        <h3 class="text-center mb-4">Bot v8.9.8 Control Panel</h3>

        <!-- Command Buttons -->
        <div class="text-center mb-4">
            <button class="btn btn-success btn-custom" onclick="sendCommand('start')">Start</button>
            <button class="btn btn-danger btn-custom" onclick="sendCommand('stop')">Stop</button>
            <button class="btn btn-info btn-custom" onclick="sendCommand('status')">Status</button>
            <button class="btn btn-primary btn-custom" onclick="sendCommand('balance')">Balance</button>
            <button class="btn btn-warning btn-custom" onclick="sendCommand('positions')">Positions</button>
            <button class="btn btn-secondary btn-custom" onclick="sendCommand('closeall')">Close All</button>
        </div>

        <!-- Log Screen -->
        <h5 class="mt-4">Log Viewer</h5>
        <div id="logScreen" class="log-screen">
            Loading logs...
        </div>
        <div class="text-center mt-2">
            <button class="btn btn-light" onclick="fetchLogs()">Refresh Logs</button>
        </div>
    </div>

    <script>
        const API_BASE_URL = 'https://covers-municipal-returns-optimal.trycloudflare.com';

        // Function to send commands to the backend
        async function sendCommand(command) {
            try {
                const response = await fetch(`${API_BASE_URL}/api/command/${command}`, {
                    method: 'POST',
                });
                const result = await response.json();
                console.log(result.message);
                alert(`Command '${command}' sent!`);
                fetchLogs(); // Refresh logs after a command
            } catch (error) {
                console.error('Error sending command:', error);
                alert(`Failed to send command: ${command}`);
            }
        }

        // Function to fetch and display logs
        async function fetchLogs() {
            const logScreen = document.getElementById('logScreen');
            try {
                const response = await fetch(`${API_BASE_URL}/api/logs`);
                const result = await response.json();
                if (result.status === 'success') {
                    logScreen.textContent = result.logs;
                    // Auto-scroll to the bottom
                    logScreen.scrollTop = logScreen.scrollHeight;
                } else {
                    logScreen.textContent = `Error fetching logs: ${result.message}`;
                }
            } catch (error) {
                console.error('Error fetching logs:', error);
                logScreen.textContent = 'Could not connect to the bot API to fetch logs.';
            }
        }

        // Initial log fetch and set up auto-refresh every 10 seconds
        document.addEventListener('DOMContentLoaded', () => {
            fetchLogs();
            setInterval(fetchLogs, 10000); // Refresh logs every 10 seconds
        });
    </script>
</body>
</html>
